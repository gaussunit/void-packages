# Template file for 'nifskope'
pkgname=nifskope
version=2.0.dev7
revision=1
_qhull_commit=9f0abe778c8ae80951f14066dfc86e4d6d391177
_gli_commit=8e43030b3e12bb58a4663d85adc5c752f89099c0
_docsys_commit=07dc05fe2c09ac8f1defd4e94c90fe60202cb191
_nifxml_commit=7e3677e97b8c7a41516ad3f03286d8737da96261
_kfmxml_commit=91eff92daf197f0c5376740ed4b000d064138ec2
build_style=qmake
configure_args="CONFIG-=zlib"
hostmakedepends="qt5-qmake"
makedepends="qt5-devel glu-devel zlib-devel"
short_desc="Tool for opening and editing the NetImmerse file format"
maintainer="John <johnz@posteo.net>"
license="BSD"
homepage="http://www.niftools.org"
distfiles="https://github.com/niftools/nifskope/archive/v${version}.tar.gz
 https://github.com/qhull/qhull/archive/${_qhull_commit}.tar.gz
 https://github.com/g-truc/gli/archive/${_gli_commit}.tar.gz
 https://github.com/niftools/nifdocsys/archive/${_docsys_commit}.tar.gz
 https://github.com/niftools/nifxml/archive/${_nifxml_commit}.tar.gz
 https://github.com/niftools/kfmxml/archive/${_kfmxml_commit}.tar.gz"
checksum="06c4d6104fb0bf95e2ae6f0f4964223a453387742deb0e144bdc121ce44d161b
 e429bfe46dea4ef5aed8a552731183403c4e1195b3c5331a511db679259d8046
 bc7bbefe109a3e237a8d1320e87277634bddea4f4796b814be16880f629958fa
 935e4619b6448ecd80850f44353b8080f995fc2b722bfa2283218d51fe49bad6
 e93f4b6c14add7a854e06208bbf74f8a5a83a1008e6271625ec9713e58a18a63
 ffd60b2ee88b3d3c9b625b3c5ddc943e52942505201a1af35b6a04d3e76eeffb"

if [ -n "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-host-tools"
fi

#Trries to set -msse, -messe2 and -mfpmath=sse which is not supported on all Platforms
case "${XBPS_TARGET_MACHINE}" in
	aarch* | arm*) broken="https://travis-ci.org/Johnnynator/void-packages/jobs/262353185"
esac

post_extract() {
	mv -T ../qhull-${_qhull_commit} ${wrksrc}/lib/qhull
	mv -T ../gli-${_gli_commit} ${wrksrc}/lib/gli
	mv -T ../nifdocsys-${_docsys_commit} ${wrksrc}/build/docsys
	mv -T ../nifxml-${_nifxml_commit} ${wrksrc}/build/docsys/nifxml
	mv -T ../kfmxml-${_kfmxml_commit} ${wrksrc}/build/docsys/kfmxml
}

do_install() {
	vbin release/NifSkope
	vlicense release/LICENSE.txt

	mv res ${DESTDIR}/usr/share/nifskope

	vinstall build/docsys/nifxml/nif.xml 644 usr/share/nifskope/
	vinstall build/docsys/kfmxml/kfm.xml 644 usr/share/nifskope/

	vinstall install/linux-install/nifskope.desktop 644 usr/share/applications

	vmkdir usr/share/pixmaps
	ln -s ../nifskope/nifskope.png ${DESTDIR}/usr/share/pixmaps/nifskope.png
}
