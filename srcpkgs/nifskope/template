# Template file for 'nifskope'
pkgname=nifskope
version=2.0.dev6
revision=1
_qhull_commit=9f0abe778c8ae80951f14066dfc86e4d6d391177
_docsys_commit=0ffd95a50c277e761ab664b68a827502d163c083
_nifxml_commit=959cb9c3dd59a319e60e819fc8a1402f821f3684
_kfmxml_commit=9d12e2faf0984b469e1bd4ddaaf3ea4bdcf60101
build_style=qmake
hostmakedepends="qt5-qmake"
makedepends="qt5-devel glu-devel zlib-devel"
short_desc="Tool for opening and editing the NetImmerse file format"
maintainer="John <johnz@posteo.net>"
license="BSD"
homepage="http://www.niftools.org"
distfiles="https://github.com/niftools/nifskope/archive/v${version}.tar.gz
 https://github.com/qhull/qhull/archive/${_qhull_commit}.tar.gz
 https://github.com/niftools/nifdocsys/archive/${_docsys_commit}.tar.gz
 https://github.com/niftools/nifxml/archive/${_nifxml_commit}.tar.gz
 https://github.com/niftools/kfmxml/archive/${_kfmxml_commit}.tar.gz"
checksum="666ad7f5a4642af39fd9315a99503879fb9739f149e36a628578dc2a285fb107
 e429bfe46dea4ef5aed8a552731183403c4e1195b3c5331a511db679259d8046
 789c25d8784645b4d1ee8da9a8a551dd3497d08f94dadb884c61bc975e87f834
 fc36eaae14644266c55323883c66959c5063dc652d0f0552da8670382a9d1d2c
 84e6315d0428282b4dafbc233f037af2c24cfe00a8ae973aa2da4175d52bdeaf"

if [ -n "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-host-tools"
fi

#Trries to set -msse, -messe2 and -mfpmath=sse which is not supported on all Platforms
case "${XBPS_TARGET_MACHINE}" in
	aarch* | arm*) broken="https://travis-ci.org/Johnnynator/void-packages/jobs/262353185"
esac

post_extract() {
	mv -T ../qhull-${_qhull_commit} ${wrksrc}/lib/qhull
	mv -T ../nifdocsys-${_docsys_commit} ${wrksrc}/build/docsys
	mv -T ../nifxml-${_nifxml_commit} ${wrksrc}/build/docsys/nifxml
	mv -T ../kfmxml-${_kfmxml_commit} ${wrksrc}/build/docsys/kfmxml
}

do_install() {
	vbin release/NifSkope
	vlicense release/Qhull_COPYING.txt
	vlicense LICENSE.md

	mv res ${DESTDIR}/usr/share/nifskope

	vinstall build/docsys/nifxml/nif.xml 644 usr/share/nifskope/
	vinstall build/docsys/kfmxml/kfm.xml 644 usr/share/nifskope/

	vinstall install/linux-install/nifskope.desktop 644 usr/share/applications

	vmkdir usr/share/pixmaps
	ln -s ../nifskope/nifskope.png ${DESTDIR}/usr/share/pixmaps/nifskope.png
}
